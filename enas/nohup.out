2019-09-09 16:34:47.858335: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2019-09-09 16:34:47.891067: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2019-09-09 16:34:48.181716: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x46cac50 executing computations on platform CUDA. Devices:
2019-09-09 16:34:48.181789: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): GeForce GTX 1080 Ti, Compute Capability 6.1
2019-09-09 16:34:48.205094: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 1598060000 Hz
2019-09-09 16:34:48.206613: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x43a76a0 executing computations on platform Host. Devices:
2019-09-09 16:34:48.206662: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2019-09-09 16:34:48.208377: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: GeForce GTX 1080 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.582
pciBusID: 0000:83:00.0
2019-09-09 16:34:48.208834: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2019-09-09 16:34:48.211397: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2019-09-09 16:34:48.213527: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2019-09-09 16:34:48.214051: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2019-09-09 16:34:48.217076: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2019-09-09 16:34:48.218961: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2019-09-09 16:34:48.224611: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2019-09-09 16:34:48.228283: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2019-09-09 16:34:48.228353: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2019-09-09 16:34:48.230043: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2019-09-09 16:34:48.230076: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2019-09-09 16:34:48.230090: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2019-09-09 16:34:48.233546: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/device:GPU:0 with 10470 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:83:00.0, compute capability: 6.1)
Using TensorFlow backend.
WARNING: Logging before flag parsing goes to stderr.
W0909 16:34:48.234693 140073800849216 deprecation_wrapper.py:119] From src/chess/main.py:395: The name tf.app.run is deprecated. Please use tf.compat.v1.app.run instead.

--------------------------------------------------------------------------------
CUDA VISIBLE DEVICES
[name: "/device:CPU:0"
device_type: "CPU"
memory_limit: 268435456
locality {
}
incarnation: 8669521010036013475
, name: "/device:XLA_GPU:0"
device_type: "XLA_GPU"
memory_limit: 17179869184
locality {
}
incarnation: 13665061513369531176
physical_device_desc: "device: XLA_GPU device"
, name: "/device:XLA_CPU:0"
device_type: "XLA_CPU"
memory_limit: 17179869184
locality {
}
incarnation: 7503937285456073491
physical_device_desc: "device: XLA_CPU device"
, name: "/device:GPU:0"
device_type: "GPU"
memory_limit: 10979036365
locality {
  bus_id: 2
  numa_node: 1
  links {
  }
}
incarnation: 13374192657367602949
physical_device_desc: "device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:83:00.0, compute capability: 6.1"
]
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
Path outputs exists. Remove and remake.
--------------------------------------------------------------------------------
Logging to outputs/stdout
--------------------------------------------------------------------------------
batch_size...................................................................128
child_block_size...............................................................3
child_cutout_size...........................................................None
child_drop_path_keep_prob....................................................0.6
child_filter_size..............................................................5
child_fixed_arc.............................................................None
child_grad_bound.............................................................5.0
child_keep_prob..............................................................0.9
child_l2_reg.............................................................0.00025
child_lr.....................................................................0.1
child_lr_T_0..................................................................10
child_lr_T_mul.................................................................2
child_lr_cosine.............................................................True
child_lr_dec_every...........................................................100
child_lr_dec_rate............................................................0.1
child_lr_max................................................................0.05
child_lr_min..............................................................0.0005
child_num_aggregate.........................................................None
child_num_branches.............................................................6
child_num_cells................................................................5
child_num_layers..............................................................12
child_num_replicas.............................................................1
child_out_filters.............................................................36
child_out_filters_scale........................................................1
child_skip_pattern..........................................................None
child_sync_replicas........................................................False
child_use_aux_heads.........................................................True
controller_bl_dec...........................................................0.99
controller_entropy_weight.................................................0.0001
controller_forwards_limit......................................................2
controller_keep_prob.........................................................0.5
controller_l2_reg............................................................0.0
controller_lr..............................................................0.001
controller_lr_dec_rate.......................................................1.0
controller_num_aggregate......................................................20
controller_num_replicas........................................................1
controller_op_tanh_reduce....................................................2.5
controller_search_whole_channels............................................True
controller_skip_target.......................................................0.4
controller_skip_weight.......................................................0.8
controller_sync_replicas....................................................True
controller_tanh_constant.....................................................1.5
controller_temperature......................................................None
controller_train_every.........................................................1
controller_train_steps........................................................50
controller_training.........................................................True
controller_use_critic......................................................False
data_format.................................................................NCHW
data_path.............................................................data/chess
eval_every_epochs..............................................................1
log_every.....................................................................50
num_epochs...................................................................310
output_dir...............................................................outputs
reset_output_dir............................................................True
search_for.................................................................macro
--------------------------------------------------------------------------------
Reading data
Loading data ...
Loading data for chess_games_2000
Loading data for chess_games_2001
Loading data for chess_games_2002
Loading data for chess_games_2003
Loading games for pgn chess_games_2003 ...
1000 games loaded
loading tensors and according labels ...
Loading data for chess_games_2004
Loading games for pgn chess_games_2004 ...
1000 games loaded
loading tensors and according labels ...
42876
Loading data ...
Loading data for chess_games_2005
Loading games for pgn chess_games_2005 ...
1000 games loaded
loading tensors and according labels ...
--------------------------------------------------------------------------------
Build model child
Build data ops
W0909 16:36:54.367503 140073800849216 deprecation.py:323] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/models.py:83: shuffle_batch (from tensorflow.python.training.input) is deprecated and will be removed in a future version.
Instructions for updating:
Queue-based input pipelines have been replaced by `tf.data`. Use `tf.data.Dataset.shuffle(min_after_dequeue).batch(batch_size)`.
W0909 16:36:59.463539 140073800849216 deprecation.py:323] From /home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/training/input.py:753: QueueRunner.__init__ (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
W0909 16:36:59.465669 140073800849216 deprecation.py:323] From /home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/training/input.py:753: add_queue_runner (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
W0909 16:36:59.533420 140073800849216 deprecation_wrapper.py:119] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/models.py:95: The name tf.random_crop is deprecated. Please use tf.image.random_crop instead.

W0909 16:37:00.244236 140073800849216 deprecation.py:323] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/models.py:142: batch (from tensorflow.python.training.input) is deprecated and will be removed in a future version.
Instructions for updating:
Queue-based input pipelines have been replaced by `tf.data`. Use `tf.data.Dataset.batch(batch_size)` (or `padded_batch(...)` if `dynamic_pad=True`).
--------------------------------------------------------------------------------
Building ConvController
W0909 16:37:01.322695 140073800849216 deprecation_wrapper.py:119] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/general_controller.py:91: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

W0909 16:37:01.323472 140073800849216 deprecation_wrapper.py:119] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/general_controller.py:96: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

--------------------------------------------------------------------------------
Build controller sampler
W0909 16:37:01.431697 140073800849216 deprecation.py:323] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/general_controller.py:184: multinomial (from tensorflow.python.ops.random_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.random.categorical` instead.
W0909 16:37:01.526556 140073800849216 deprecation_wrapper.py:119] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/general_controller.py:278: The name tf.log is deprecated. Please use tf.math.log instead.

--------------------------------------------------------------------------------
Build train graph
Tensor("map/TensorArrayStack/TensorArrayGatherV3:0", shape=(?, 7, 8, 8), dtype=float32)
W0909 16:37:05.766565 140073800849216 lazy_loader.py:50] 
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.

W0909 16:37:05.782546 140073800849216 deprecation.py:506] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/image_ops.py:115: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
W0909 16:37:05.806559 140073800849216 deprecation_wrapper.py:119] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/image_ops.py:134: The name tf.nn.fused_batch_norm is deprecated. Please use tf.compat.v1.nn.fused_batch_norm instead.

W0909 16:37:05.989675 140073800849216 deprecation.py:323] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/image_ops.py:176: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
W0909 16:37:06.139519 140073800849216 deprecation_wrapper.py:119] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/image_ops.py:216: The name tf.scatter_sub is deprecated. Please use tf.compat.v1.scatter_sub instead.

2019-09-09 16:37:07.575369: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: 
name: GeForce GTX 1080 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.582
pciBusID: 0000:83:00.0
2019-09-09 16:37:07.575455: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2019-09-09 16:37:07.575479: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2019-09-09 16:37:07.575502: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2019-09-09 16:37:07.575522: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2019-09-09 16:37:07.575548: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2019-09-09 16:37:07.575568: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2019-09-09 16:37:07.575588: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2019-09-09 16:37:07.579687: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2019-09-09 16:37:07.579778: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2019-09-09 16:37:07.579809: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 
2019-09-09 16:37:07.579822: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N 
2019-09-09 16:37:07.583264: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 10470 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:83:00.0, compute capability: 6.1)
W0909 16:37:09.243517 140073800849216 deprecation_wrapper.py:119] From /home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:3980: The name tf.nn.avg_pool is deprecated. Please use tf.nn.avg_pool2d instead.

W0909 16:37:09.346338 140073800849216 deprecation_wrapper.py:119] From /home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:3976: The name tf.nn.max_pool is deprecated. Please use tf.nn.max_pool2d instead.

Tensor("child/layer_0/case/cond/Merge:0", shape=(?, 36, 8, 8), dtype=float32)
Tensor("child/layer_1/skip/bn/Identity:0", shape=(?, 36, 8, 8), dtype=float32)
Tensor("child/layer_2/skip/bn/Identity:0", shape=(?, 36, 8, 8), dtype=float32)
Tensor("child/layer_3/pool_at_3/from_4/bn/Identity:0", shape=(?, 36, 4, 4), dtype=float32)
Tensor("child/layer_4/skip/bn/Identity:0", shape=(?, 36, 4, 4), dtype=float32)
Tensor("child/layer_5/skip/bn/Identity:0", shape=(?, 36, 4, 4), dtype=float32)
Tensor("child/layer_6/skip/bn/Identity:0", shape=(?, 36, 4, 4), dtype=float32)
Tensor("child/layer_7/pool_at_7/from_8/bn/Identity:0", shape=(?, 36, 2, 2), dtype=float32)
Tensor("child/layer_8/skip/bn/Identity:0", shape=(?, 36, 2, 2), dtype=float32)
Tensor("child/layer_9/skip/bn/Identity:0", shape=(?, 36, 2, 2), dtype=float32)
Tensor("child/layer_10/skip/bn/Identity:0", shape=(?, 36, 2, 2), dtype=float32)
Tensor("child/layer_11/skip/bn/Identity:0", shape=(?, 36, 2, 2), dtype=float32)
W0909 16:37:30.802047 140073800849216 deprecation.py:506] From /home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/general_child.py:245: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
Traceback (most recent call last):
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py", line 527, in _apply_op_helper
    preferred_dtype=default_dtype)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py", line 1224, in internal_convert_to_tensor
    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/framework/ops.py", line 1018, in _TensorTensorConversionFunction
    (dtype.name, t.dtype.name, str(t)))
ValueError: Tensor conversion requested dtype float32 for Tensor with dtype float64: 'Tensor("Log_11:0", shape=(?,), dtype=float64)'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "src/chess/main.py", line 395, in <module>
    tf.app.run()
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/platform/app.py", line 40, in run
    _run(main=main, argv=argv, flags_parser=_parse_flags_tolerate_undef)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/absl/app.py", line 300, in run
    _run_main(main, args)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/absl/app.py", line 251, in _run_main
    sys.exit(main(argv))
  File "src/chess/main.py", line 384, in main
    train()
  File "src/chess/main.py", line 235, in train
    ops = get_ops(images, labels)
  File "src/chess/main.py", line 182, in get_ops
    child_model.connect_controller(controller_model)
  File "/home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/general_child.py", line 879, in connect_controller
    self._build_train()
  File "/home/habreu/pv/lothair/EfficientNeuralSearch/enas/src/chess/general_child.py", line 759, in _build_train
    log_probs = tf.keras.backend.categorical_crossentropy(target=logits, output=self.y_train, axis=1)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/keras/backend.py", line 4149, in categorical_crossentropy
    return -math_ops.reduce_sum(target * math_ops.log(output), axis)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py", line 884, in binary_op_wrapper
    return func(x, y, name=name)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py", line 1180, in _mul_dispatch
    return gen_math_ops.mul(x, y, name=name)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/ops/gen_math_ops.py", line 6490, in mul
    "Mul", x=x, y=y, name=name)
  File "/home/habreu/pv/lothair/venv_3/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py", line 563, in _apply_op_helper
    inferred_from[input_arg.type_attr]))
TypeError: Input 'y' of 'Mul' Op has type float64 that does not match type float32 of argument 'x'.
Exception ignored in: <src.utils.Logger object at 0x7f6513fbbeb8>
AttributeError: 'Logger' object has no attribute 'flush'
